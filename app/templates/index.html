<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
</head>

{% extends "base.html" %}

{% block content %}

<br><br>

<div id="formContainer">
  <!-- <form action="/" method="post" id="showAllForm">
    <button type="submit" name="action" value="showAll">Show All Products</button>
  </form> -->

  <form method="post" id="topKForm">
    <label for="topK">Enter number of product to display:</label>
    <input type="number" id="topK" name="topK" min="1" value="">
    <button type="submit">Sort by Price</button>
  </form>

  <form action="/" method="get" class="filter-form">
    <select name="category" id="categorySelect">
        <option value="">All Categories</option>
        {% for category in categories %}
        <option value="{{ category.catkey }}">{{ category.catname }}</option>
        {% endfor %}
    </select>
    <!-- Confirm button on the right -->
    <button type="submit">Filter by Category</button>
  </form>
</div>

<br><br>

<h2>Products for sale:</h2>
<table class='table table-hover table-bordered container'>
  <thead class="thead-dark">
    <tr>
      <th scope="col">Product ID</th>
      <th scope="col">Product Name</th>
      <th scope="col">Category</th>
      <th scope="col">Price</th>
    </tr>
  </thead>
  <tbody>
    {% for product in avail_products%}
      <tr>
        <th scope="row">{{product.p_productkey}}</th>
        <td><a href="/product/{{ product.p_productkey }}">{{product.p_productname}}</td>
        <td>{{product.p_catname}}</td>
        <td>{{product.p_price}}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>

<br><br>

<script>
  // Wait for the DOM to be fully loaded
  document.addEventListener('DOMContentLoaded', function() {
    // Check if there's a stored value in Local Storage and set it as the input value
    const savedTopK = localStorage.getItem('topKValue');
    if (savedTopK) {
      document.getElementById('topK').value = savedTopK;
    }
  
    // Listen for form submission to store the input value
    document.getElementById('topKForm').addEventListener('submit', function() {
      const topKValue = document.getElementById('topK').value;
      localStorage.setItem('topKValue', topKValue);
    });
  });

 
  document.addEventListener('DOMContentLoaded', (event) => {
      // Retrieve the current URL
      const urlParams = new URLSearchParams(window.location.search);
      const category = urlParams.get('category'); // Get the category parameter from the URL

      if (category) {
          // If there's a category selected, set it as the selected value in the dropdown
          document.getElementById('categorySelect').value = category;
      }
  });

  </script>


{% endblock %}
